var C=Object.defineProperty;var R=(p,e,t)=>e in p?C(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var r=(p,e,t)=>R(p,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const i=32,m=32,w=32,M=768,j=512,D=i/2,k=[{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,33,34,33,34,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,29,3,3,3,3,3,3,3,3,3,3,3,41,42,41,42,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,16,3,3,3,3,3,3,3,3,3,3,3,49,50,49,50,12,12,21,29,13,32,31,5,31,23,24,3,3,0,0,3,15,3,3,3,3,3,3,3,3,3,3,3,57,58,57,58,12,12,14,8,29,24,22,21,15,24,32,3,3,0,0,3,29,31,15,30,3,3,3,3,3,3,3,3,53,54,55,56,12,12,24,16,13,24,6,32,14,31,22,21,23,0,0,3,3,5,30,3,3,3,3,3,3,3,3,3,61,62,63,64,12,12,29,21,8,5,23,16,22,30,31,3,3,0,0,3,3,23,29,29,3,3,3,3,3,3,3,3,53,54,55,56,12,12,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,15,23,15,3,3,3,3,3,3,3,3,61,62,63,64,12,12,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,16,7,29,16,3,3,3,3,3,3,53,54,55,56,12,12,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,53,54,55,56,12,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,30,3,3,3,3,61,62,63,64,12,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,16,22,1,1,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,7,3,29,1,1,1,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,3,22,16,3,3,1,1,1,1,1,1,1,33,33,1,1,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,53,54,55,56,53,54,55,56,53,54,55,56,0,0,3,3,3,3,3,3,3,3,3,3,1,1,3,11,11,3,1,1,61,62,63,64,61,62,63,64,61,62,63,64,0,0,3,53,54,55,56,53,54,55,56,37,38,39,40,1,11,11,1,1,53,54,55,56,53,54,55,56,53,54,55,56,0,0,3,61,62,63,64,61,62,63,64,45,46,47,48,1,11,11,1,1,61,62,63,64,61,62,63,64,61,62,63,64,0,0,3,3,3,3,3,3,3,3,1,1,1,1,3,33,34,1,1,1,33,3,3,3,3,3,3,33,33,3,3,3,0,0,3,3,3,3,3,3,3,3,1,1,1,1,3,33,34,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,1,3,3,1,1,41,42,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,3,3,3,1,1,49,50,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,3,3,3,3,3,3,3,3,1,1,1,1,3,33,34,3,3,3,3,3,3,3,13,14,14,24,13,7,3,3,0,0,3,3,3,29,22,13,29,3,3,3,3,3,3,41,42,3,3,3,3,3,3,3,5,29,6,21,3,14,3,3,0,0,3,3,31,15,31,6,7,31,3,3,3,3,3,49,50,3,3,3,3,3,3,3,29,32,29,8,3,16,3,3,0,0,3,3,6,7,5,30,31,3,3,3,3,3,3,57,58,3,3,3,3,3,3,3,22,32,24,32,29,5,3,3,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,29,14,31,22,3,3,3,3,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:32,id:1,name:"grass-layer",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{data:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,0,79,0,104,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,120,0,95,0,120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,136,0,111,0,136,0,0,0,0,0,0,148,0,106,107,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,122,123,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,72,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,72,0,204,205,206,0,72,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,88,0,220,221,222,0,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,236,237,238,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,72,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,168,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,216,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,232,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,254,255,214,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,214,270,271,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],height:32,id:3,name:"props-layer",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0},{draworder:"topdown",id:6,name:"highlights",objects:[{gid:89,height:32,id:32,name:"",rotation:0,type:"",visible:!0,width:32,x:575.219855659215,y:569.968198087191},{gid:89,height:32,id:33,name:"",rotation:0,type:"",visible:!0,width:32,x:479.086545795928,y:506.279880302764},{gid:89,height:32,id:34,name:"",rotation:0,type:"",visible:!0,width:32,x:382.953235932641,y:573.573197207064},{gid:89,height:32,id:35,name:"",rotation:0,type:"",visible:!0,width:32,x:480.288212169219,y:666.101507950478},{gid:203,height:32,id:36,name:"",rotation:0,type:"",visible:!0,width:32,x:480.5,y:576.75},{gid:169,height:32,id:37,name:"",rotation:0,type:"",visible:!0,width:32,x:518.75,y:572.25},{gid:1073741993,height:32,id:38,name:"",rotation:-90,type:"",visible:!0,width:32,x:513.75,y:547},{gid:1073741993,height:32,id:39,name:"",rotation:0,type:"",visible:!0,width:32,x:442,y:574},{gid:1073741993,height:32,id:40,name:"",rotation:-90,type:"",visible:!0,width:32,x:513.75,y:601.25},{gid:137,height:32,id:41,name:"",rotation:0,type:"",visible:!0,width:32,x:864,y:174},{gid:137,height:32,id:42,name:"",rotation:0,type:"",visible:!0,width:32,x:864,y:191},{gid:137,height:32,id:43,name:"",rotation:0,type:"",visible:!0,width:32,x:735.75,y:173.25},{gid:137,height:32,id:44,name:"",rotation:0,type:"",visible:!0,width:32,x:735.75,y:193.5},{gid:169,height:32,id:47,name:"",rotation:0,type:"",visible:!0,width:32,x:160,y:831},{gid:169,height:32,id:48,name:"",rotation:0,type:"",visible:!0,width:32,x:318,y:1211}],opacity:1,type:"objectgroup",visible:!0,x:0,y:0},{data:[365,366,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,365,366,381,382,418,419,420,421,418,419,420,418,419,420,421,418,419,420,421,418,419,420,421,418,419,420,421,420,418,419,420,421,381,382,397,398,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,397,398,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,347,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,346,363,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,362,379,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,378,365,366,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,365,366,381,382,418,419,420,421,467,418,419,420,421,467,467,467,467,467,467,467,467,467,467,467,467,467,467,467,467,467,467,467,381,382,397,398,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,397,398],height:32,id:2,name:"wall-layer",opacity:1,type:"tilelayer",visible:!0,width:32,x:0,y:0}],x={layers:k};class L{constructor(){r(this,"level1");r(this,"tileMapCols");r(this,"wallTileMapCols");r(this,"propsTileMapCols");if(!x.layers[0].data||!x.layers[1].data||!x.layers[3].data)throw new Error("Error loading data from JSON: Missing or invalid layer data");this.level1={grassLayer:x.layers[0].data,propsLayer:x.layers[1].data,wallsLayer:x.layers[3].data,backgroundLayer:document.querySelector("#grass-tileset"),collitionTileset:document.querySelector("#wall-tileset"),propsTileset:document.querySelector("#props-tileset")},this.tileMapCols=this.level1.backgroundLayer.width/i,this.wallTileMapCols=this.level1.collitionTileset.width/i,this.propsTileMapCols=this.level1.propsTileset.width/i}getTile(e,t,s){if(t<0||t>=m||s<0||s>=w)throw new Error(`ERROR: Out of bound tileMap(col:${t},row:${s})`);return e[s*m+t]||0}drawBackground(e,t){const s=Math.floor(t.x/i),o=Math.min(s+Math.ceil(t.width/i),m-1),a=Math.floor(t.y/i),h=Math.min(a+Math.ceil(t.height/i),w-1),n=1;for(let l=a;l<=h;l++)for(let d=s;d<=o;d++){const y=this.getTile(this.level1.grassLayer,d,l);if(y>=n){const c=y-n,g=c%this.tileMapCols*i,f=Math.floor(c/this.tileMapCols)*i,b=d*i,u=l*i;e.drawImage(this.level1.backgroundLayer,g,f,i,i,Math.round(b),Math.round(u),i,i)}}}drawWalls(e,t){const s=Math.floor(t.x/i),o=Math.min(s+Math.ceil(t.width/i),m-1),a=Math.floor(t.y/i),h=Math.min(a+Math.ceil(t.height/i),w-1),n=321;for(let l=a;l<=h;l++)for(let d=s;d<=o;d++){const y=this.getTile(this.level1.wallsLayer,d,l);if(y>=n){const c=y-n,g=c%this.wallTileMapCols*i,f=Math.floor(c/this.wallTileMapCols)*i,b=d*i,u=l*i;e.drawImage(this.level1.collitionTileset,g,f,i,i,Math.round(b),Math.round(u),i,i)}}}drawProps(e,t){const s=Math.floor(t.x/i),o=Math.min(s+Math.ceil(t.width/i),m-1),a=Math.floor(t.y/i),h=Math.min(a+Math.ceil(t.height/i),w-1),n=65;for(let l=a;l<=h;l++)for(let d=s;d<=o;d++){const y=this.getTile(this.level1.propsLayer,d,l);if(y>=n){const c=y-n,g=c%this.propsTileMapCols*i,f=Math.floor(c/this.propsTileMapCols)*i,b=d*i,u=l*i;e.drawImage(this.level1.propsTileset,g,f,i,i,Math.round(b),Math.round(u),i,i)}}}drawGrid(e,t){const s=Math.floor(t.x/i),o=Math.min(s+Math.ceil(t.width/i),m-1),a=Math.floor(t.y/i),h=Math.min(a+Math.ceil(t.height/i),w-1);e.strokeStyle="green";for(let n=0;n<=h;n++)for(let l=0;l<=o;l++)e.strokeRect(l*i,n*i,i,i),e.fillStyle="black",e.font="12px",e.fillText(`${l}:${n}`,l*i-24,n*i-12)}drawCollitionGrid(e,t){const s=Math.floor(t.x/i),o=Math.min(s+Math.ceil(t.width/i),m-1),a=Math.floor(t.y/i),h=Math.min(a+Math.ceil(t.height/i),w-1);e.fillStyle="rgba(0,0,255,0.4)";for(let n=a;n<=h;n++)for(let l=s;l<=o;l++)this.getTile(this.level1.wallsLayer,l,n)&&e.fillRect(l*i,n*i,i,i)}drawPropsGrid(e,t){const s=Math.floor(t.x/i),o=Math.min(s+Math.ceil(t.width/i),m-1),a=Math.floor(t.y/i),h=Math.min(a+Math.ceil(t.height/i),w-1);e.fillStyle="rgba(255,0,0,0.4)";for(let n=a;n<=h;n++)for(let l=s;l<=o;l++)this.getTile(this.level1.propsLayer,l,n)&&e.fillRect(l*i,n*i,i,i)}}class G{constructor(e){r(this,"gameObj");r(this,"width");r(this,"height");r(this,"debug");this.gameObj={game:e.game,sprite:e.sprite=e.sprite??{x:0,y:0,width:i,height:i},position:e.position=e.position??{x:1,y:1},scale:e.scale=e.scale??1,destPosition:{x:e.position.x,y:e.position.y},distToTravel:{x:0,y:0}},this.width=this.gameObj.sprite.width*this.gameObj.scale,this.height=this.gameObj.sprite.height*this.gameObj.scale,this.debug=!0}moveTowards(e,t){this.gameObj.distToTravel.x=this.gameObj.destPosition.x-this.gameObj.position.x,this.gameObj.distToTravel.y=this.gameObj.destPosition.y-this.gameObj.position.y;let s=Math.hypot(this.gameObj.distToTravel.x,this.gameObj.distToTravel.y);if(s<=t)this.gameObj.position.x=e.x,this.gameObj.position.y=e.y;else{const o=this.gameObj.distToTravel.x/s,a=this.gameObj.distToTravel.y/s;this.gameObj.position.x+=o*t,this.gameObj.position.y+=a*t,this.gameObj.distToTravel.x=e.x-this.gameObj.position.x,this.gameObj.distToTravel.y=e.y-this.gameObj.position.y,s=Math.hypot(this.gameObj.distToTravel.x,this.gameObj.distToTravel.y)}return s}draw(e){this.gameObj.game.debugMode&&(e.fillStyle="blue",e.fillRect(this.gameObj.position.x,this.gameObj.position.y,i,i),e.strokeStyle="yellow",e.strokeRect(this.gameObj.destPosition.x,this.gameObj.destPosition.y,i,i)),e.drawImage(this.gameObj.sprite.image,this.gameObj.sprite.x*this.gameObj.sprite.width,this.gameObj.sprite.y*this.gameObj.sprite.height,this.gameObj.sprite.width,this.gameObj.sprite.height,this.gameObj.position.x-D,this.gameObj.position.y-i,this.width,this.height)}}var O=(p=>(p.UP="UP",p.DOWN="DOWN",p.LEFT="LEFT",p.RIGHT="RIGHT",p))(O||{});class N{constructor(e){r(this,"keys");r(this,"game");this.keys=[],this.game=e,window.addEventListener("keydown",t=>{let s=t.key;(s==="ArrowLeft"||s==="a")&&this.handleKeyDown("LEFT"),(s==="ArrowRight"||s==="d")&&this.handleKeyDown("RIGHT"),(s==="ArrowUp"||s==="w")&&this.handleKeyDown("UP"),(s==="ArrowDown"||s==="s")&&this.handleKeyDown("DOWN");let o=!1;for(const[a,h]of this.game.players)h.username==="@anubhav"&&(o=!0);s===" "&&o&&this.game.toggleDebugMode()}),window.addEventListener("keyup",t=>{let s=t.key;(s==="ArrowLeft"||s==="a")&&this.handleKeyUp("LEFT"),(s==="ArrowRight"||s==="d")&&this.handleKeyUp("RIGHT"),(s==="ArrowUp"||s==="w")&&this.handleKeyUp("UP"),(s==="ArrowDown"||s==="s")&&this.handleKeyUp("DOWN")})}handleKeyDown(e){this.keys.indexOf(e)===-1&&this.keys.unshift(e)}handleKeyUp(e){const t=this.keys.indexOf(e);t>-1&&this.keys.splice(t,1)}lastKey(){return this.keys[0]}}class F{constructor(e,t,s,o){r(this,"x");r(this,"y");r(this,"width");r(this,"height");r(this,"maxX");r(this,"maxY");this.x=0,this.y=0,this.width=e,this.height=t,this.maxX=s-this.width,this.maxY=o-this.height}update(e,t){this.x=e-this.width/2,this.y=t-this.height/2,this.x=Math.max(0,Math.min(this.x,this.maxX)),this.y=Math.max(0,Math.min(this.y,this.maxY))}}class P extends G{constructor(t,s){super(t);r(this,"speed");r(this,"maxHeroSpriteFrame");r(this,"isMoving");r(this,"username");r(this,"speedX");r(this,"speedY");r(this,"camera");this.speed=128,this.maxHeroSpriteFrame=8,this.isMoving=!1,this.username=s,this.speedX=0,this.speedY=0,this.camera=new F(M,j,m*i,w*i)}update(t,s){if(!s){this.isMoving&&this.gameObj.game.eventUpdate&&(this.gameObj.sprite.x<this.maxHeroSpriteFrame-1?this.gameObj.sprite.x++:this.gameObj.sprite.x=0),this.camera.update(this.gameObj.position.x,this.gameObj.position.y);return}let o=this.gameObj.destPosition.x,a=this.gameObj.destPosition.y;const h=this.speed*(t/1e3),n=this.moveTowards(this.gameObj.destPosition,h),l=n<=h;if(this.speedX=0,this.speedY=0,l){const d=this.gameObj.game.input.keys;let y=!1;if(d.includes(O.UP)?(a-=i,this.gameObj.sprite.y=8,this.speedY=-1,y=!0):d.includes(O.DOWN)?(a+=i,this.gameObj.sprite.y=10,this.speedY=1,y=!0):d.includes(O.LEFT)?(o-=i,this.gameObj.sprite.y=9,this.speedX=-1,y=!0):d.includes(O.RIGHT)&&(o+=i,this.gameObj.sprite.y=11,this.speedX=1,y=!0),y){const c=Math.floor(o/i),g=Math.floor(a/i),f=this.gameObj.game.world.getTile(this.gameObj.game.world.level1.wallsLayer,c,g),b=this.gameObj.game.world.getTile(this.gameObj.game.world.level1.propsLayer,c,g);let u=!1;for(const[K,v]of this.gameObj.game.players)if(v!=this){const I=Math.floor(v.gameObj.position.x/i),S=Math.floor(v.gameObj.position.y/i);if(c===I&&g===S){u=!0;break}}!f&&!b&&!u&&(this.gameObj.destPosition.x=o,this.gameObj.destPosition.y=a)}}this.isMoving=this.gameObj.game.input.keys.length>0||n>0,this.gameObj.game.eventUpdate&&this.isMoving&&(this.gameObj.sprite.x<this.maxHeroSpriteFrame-1?this.gameObj.sprite.x++:this.gameObj.sprite.x=0,this.gameObj.game.network.sendPlayerPosition(Math.floor(this.gameObj.position.x),Math.floor(this.gameObj.position.y))),this.camera.update(this.gameObj.position.x,this.gameObj.position.y)}draw(t){super.draw(t),t.fillStyle="white",t.font="12px Electrolize",t.fillText(this.username,this.gameObj.position.x-10,this.gameObj.position.y-20)}}class U{constructor(e,t){r(this,"game");r(this,"ws");r(this,"onPlayerIDSet");this.game=e,this.onPlayerIDSet=t,this.ws=new WebSocket("ws://localhost:8080/ws"),this.ws.addEventListener("open",()=>{console.log("== WEBSOCKET CONNECTED ==")}),this.ws.addEventListener("message",s=>{try{const o=JSON.parse(s.data);console.log("STEP 2: SERVER SEND>",JSON.stringify(o)),this.handleMessage(o)}catch(o){console.error("Error parsing WebSocket message:",o)}}),this.ws.addEventListener("close",()=>{console.log("== WEBSOCKET DISCONNECTED ==")})}handleMessage(e){switch(console.log("== handlemsg =="),console.log(`data.type: ${e.type}`),e.type){case"playerID":this.game.localPlayerID=e.id,this.onPlayerIDSet({id:e.id,px:e.x,py:e.y});break;case"playerJoined":console.log("[client] playerJoined with ID:",e.id),this.game.addRemotePlayer(e.id,e.x,e.y);break;case"playerMoved":this.game.updateRemotePlayer(e.id,e.x,e.y);break;case"playerLeft":this.game.removeRemotePlayer(e.id);break}}sendPlayerPosition(e,t){if(this.game.localPlayerID&&this.ws.readyState===WebSocket.OPEN){const s={id:this.game.localPlayerID,type:"playerMoved",x:e,y:t};this.ws.send(JSON.stringify(s))}}}class W{constructor(e){r(this,"usernameInput");r(this,"joinButton");r(this,"container");r(this,"onJoin");this.onJoin=e,this.container=document.createElement("div"),this.container.className="join-container",this.usernameInput=document.createElement("input"),this.usernameInput.type="text",this.usernameInput.placeholder="Enter username",this.joinButton=document.createElement("button"),this.joinButton.textContent="Join the Arena",this.usernameInput.addEventListener("keydown",t=>{if(t.key==="Enter"){const s=this.usernameInput.value.trim();s&&(this.onJoin(s),this.hide())}}),this.joinButton.addEventListener("click",()=>{const t=this.usernameInput.value.trim();t&&(this.onJoin(t),this.hide())}),this.container.append(this.usernameInput),this.container.appendChild(this.joinButton),document.body.appendChild(this.container)}hide(){this.usernameInput.remove(),this.joinButton.remove()}}class A{constructor(e){r(this,"world");r(this,"input");r(this,"player",null);r(this,"localPlayerID",null);r(this,"players");r(this,"network");r(this,"eventUpdate",!1);r(this,"eventTimer",0);r(this,"eventInterval",200);r(this,"ctx");r(this,"debugMode");r(this,"pendingPlayerData",null);this.ctx=e,this.world=new L,this.input=new N(this),this.debugMode=!1,this.players=new Map,this.network=new U(this,t=>{this.pendingPlayerData=t,this.localPlayerID=t.id}),new W(t=>{this.pendingPlayerData?(this.startGame(t,this.pendingPlayerData.px,this.pendingPlayerData.py),this.pendingPlayerData=null):console.log("No server data available")})}toggleDebugMode(){this.debugMode=!this.debugMode}startGame(e,t,s){const o={game:this,position:{x:t,y:s},sprite:{x:0,y:2,width:64,height:64,image:document.querySelector("#hero1")}};this.localPlayerID&&(this.player=new P(o,e),this.players.set(this.localPlayerID,this.player));let a=0;const h=document.querySelector(".fps"),n=l=>{const d=l-a;h.textContent=String(Math.round(1e3/d)),a=l,this.ctx.clearRect(0,0,M,j),this.render(d),requestAnimationFrame(n)};requestAnimationFrame(n)}addRemotePlayer(e,t,s,o=`Player_${e}`){if(e===this.localPlayerID)return;const a={game:this,position:{x:t,y:s},sprite:{x:0,y:2,width:64,height:64,image:document.querySelector("#hero1")}},h=new P(a,o);this.players.set(e,h)}updateRemotePlayer(e,t,s){const o=this.players.get(e);if(o&&e!==this.localPlayerID){const a=o.gameObj.position.x,h=o.gameObj.position.y,n=t+2,l=s+2;o.gameObj.position.x=n,o.gameObj.position.y=l,o.gameObj.destPosition.x=n,o.gameObj.destPosition.y=l,o.isMoving=n!==a||l!==h,o.isMoving?n>a?o.gameObj.sprite.y=11:n<a?o.gameObj.sprite.y=9:l>h?o.gameObj.sprite.y=10:l<h&&(o.gameObj.sprite.y=8):(o.gameObj.sprite.x=0,o.isMoving=!1)}}removeRemotePlayer(e){this.players.delete(e)&&console.log(`Removed player ${e}`)}render(e){this.player&&(this.eventTimer<this.eventInterval?(this.eventTimer+=e,this.eventUpdate=!1):(this.eventTimer-=this.eventInterval,this.eventUpdate=!0),this.ctx.save(),this.ctx.translate(-this.player.camera.x,-this.player.camera.y),this.world.drawBackground(this.ctx,this.player.camera),this.world.drawProps(this.ctx,this.player.camera),this.world.drawWalls(this.ctx,this.player.camera),this.debugMode&&(this.world.drawGrid(this.ctx,this.player.camera),this.world.drawCollitionGrid(this.ctx,this.player.camera),this.world.drawPropsGrid(this.ctx,this.player.camera)),this.players.forEach(t=>{t.draw(this.ctx),t.update(e,t===this.player)}),this.ctx.restore())}}const T=document.querySelector("#canvas"),E=T.getContext("2d");E.imageSmoothingEnabled=!1;T.width=M;T.height=j;new A(E);
